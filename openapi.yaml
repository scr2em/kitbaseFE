openapi: 3.0.0
info:
  title: Flyway API
  description: |
    API for Flyway application.
    
    ## Subdomain-based Organization Context
    
    Most endpoints require organization context, which is determined by the subdomain of the request.
    For example, requests to `myorg.flyway.com/api/...` will operate in the context of the "myorg" organization.
    
    For local development, use the `X-Subdomain` header to specify the organization subdomain.
  version: 1.0.0
servers:
  - url: http://localhost:8080/api
    description: Local development server
  - url: https://{subdomain}.flyway.com/api
    description: Production server with subdomain
    variables:
      subdomain:
        default: app
        description: Organization subdomain

tags:
  - name: Authentication
    description: User authentication and authorization operations
  - name: Organizations
    description: Organization management operations
  - name: Invitations
    description: Invitation management operations
  - name: Members
    description: Organization members management operations
  - name: Users
    description: User management operation
  - name: Roles & Permissions
    description: Role and permission management operations
  - name: Projects
    description: Project management operations
  - name: Environments
    description: Environment management operations
  - name: Changelogs
    description: Changelog management for projects
  - name: Builds
    description: Build management operations
  - name: OTA Updates
    description: Over-the-air update management operations
  - name: API Keys
    description: API key management for build uploads
  - name: Audit Logs
    description: Audit log and activity tracking operations
  - name: Notifications
    description: User notification management
  - name: Webhooks
    description: Webhook subscription management
  - name: Events
    description: Custom event logging and tracking (SDK)
  - name: Event Analytics
    description: Event viewing and analytics (Dashboard)

components:
  schemas:
    # Enums - Define all enums first
    UserStatusEnum:
      type: string
      enum: [active, inactive, pending, suspended]
      description: User account status
    
    InvitationStatusEnum:
      type: string
      enum: [pending, accepted, expired, canceled]
      description: Invitation status

    MembershipStatusEnum:
      type: string
      enum: [active, inactive]
      description: Organization membership status

    NotificationTypeEnum:
      type: string
      enum: [invitation_received, build_completed, member_joined, member_removed, log_rate_exceeded]
      description: Type of notification

    # Webhook Event Types - events that can trigger webhooks
    WebhookEventTypeEnum:
      type: string
      enum: [invitation_received, build_completed, member_joined, member_removed, log_rate_exceeded]
      description: Event types that can trigger webhook deliveries

    # Project Type - framework/technology used by the project
    ProjectType:
      type: string
      enum: [react, angular, vue, nextjs, ionic, flutter, others]
      description: The framework or technology type of the project

    # OTA Update Mode - how the update should be applied
    OtaUpdateModeEnum:
      type: string
      enum: [force, silent, prompt]
      description: |
        Update mode for OTA updates:
        - force: Update is applied immediately, user cannot skip
        - silent: Update is applied silently in the background
        - prompt: User is prompted to update, can skip

    # OTA Target Platform - which platforms the update targets
    OtaTargetPlatformEnum:
      type: string
      enum: [ios, android, both]
      description: Target platform for the OTA update

    # OTA Targeting Condition - single condition for targeting
    TargetingCondition:
      type: object
      description: A single targeting condition
      required:
        - field
        - op
        - value
      properties:
        field:
          type: string
          description: Metadata field name (e.g., user_id, device_id)
        op:
          type: string
          enum: [eq, neq]
          description: Operator - eq (equals), neq (not equals)
        value:
          type: string
          description: Value to compare against

    # OTA Targeting Conditions - group of conditions with AND/OR operator
    TargetingConditions:
      type: object
      description: Targeting conditions with AND/OR operator
      required:
        - operator
        - conditions
      properties:
        operator:
          type: string
          enum: [and, or]
          description: How conditions are combined
        conditions:
          type: array
          items:
            $ref: '#/components/schemas/TargetingCondition'
          description: List of targeting conditions

    # Webhook Request DTOs
    CreateWebhookRequest:
      type: object
      description: Request to create a new webhook subscription
      required:
        - name
        - url
        - events
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Human-readable name for the webhook
        url:
          type: string
          format: uri
          maxLength: 2048
          description: The URL to send webhook payloads to
        secret:
          type: string
          maxLength: 255
          description: Optional secret for HMAC signature verification
        events:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/WebhookEventTypeEnum'
          description: List of events this webhook should receive
        enabled:
          type: boolean
          default: true
          description: Whether the webhook is enabled

    UpdateWebhookRequest:
      type: object
      description: Request to update an existing webhook subscription
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Human-readable name for the webhook
        url:
          type: string
          format: uri
          maxLength: 2048
          description: The URL to send webhook payloads to
        secret:
          type: string
          maxLength: 255
          description: Secret for HMAC signature verification (send empty string to clear)
        events:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/WebhookEventTypeEnum'
          description: List of events this webhook should receive
        enabled:
          type: boolean
          description: Whether the webhook is enabled

    # Webhook Response DTOs
    WebhookResponse:
      type: object
      description: Webhook subscription details
      required:
        - id
        - name
        - url
        - events
        - enabled
        - createdAt
      properties:
        id:
          type: string
          description: Unique identifier for the webhook
        name:
          type: string
          description: Human-readable name for the webhook
        url:
          type: string
          description: The URL webhook payloads are sent to
        events:
          type: array
          items:
            $ref: '#/components/schemas/WebhookEventTypeEnum'
          description: List of events this webhook receives
        enabled:
          type: boolean
          description: Whether the webhook is enabled
        lastSuccessAt:
          type: string
          format: date-time
          description: Timestamp of last successful delivery
        lastFailureAt:
          type: string
          format: date-time
          description: Timestamp of last failed delivery
        failureCount:
          type: integer
          description: Number of consecutive failures
        createdAt:
          type: string
          format: date-time
          description: When the webhook was created
        updatedAt:
          type: string
          format: date-time
          description: When the webhook was last updated

    WebhookDeliveryResponse:
      type: object
      description: Webhook delivery record
      required:
        - id
        - webhookId
        - eventType
        - success
        - createdAt
      properties:
        id:
          type: string
          description: Unique identifier for the delivery
        webhookId:
          type: string
          description: ID of the webhook subscription
        eventType:
          type: string
          description: Type of event that triggered the delivery
        statusCode:
          type: integer
          description: HTTP status code of the response
        success:
          type: boolean
          description: Whether the delivery was successful
        requestPayload:
          type: object
          additionalProperties: true
          description: The payload that was sent
        responseBody:
          type: string
          description: Response body from the webhook endpoint (truncated)
        durationMs:
          type: integer
          description: Duration of the request in milliseconds
        errorMessage:
          type: string
          description: Error message if the delivery failed
        createdAt:
          type: string
          format: date-time
          description: When the delivery was attempted

    PaginatedWebhookResponse:
      type: object
      description: Paginated list of webhooks
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/WebhookResponse'
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
        totalPages:
          type: integer

    PaginatedWebhookDeliveryResponse:
      type: object
      description: Paginated list of webhook deliveries
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/WebhookDeliveryResponse'
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
        totalPages:
          type: integer

    # Request DTOs
    UserRegistrationRequest:
      type: object
      description: Request to register a new user
      required:
        - email
        - password
        - firstName
        - lastName
      properties:
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 50
          description: User's password (minimum 8 characters and max 50 characters)
        firstName:
          type: string
          minLength: 2
          description: User's first name
        lastName:
          type: string
          minLength: 2
          description: User's last name

    LoginRequest:
      type: object
      description: Request to login
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          format: password
          description: User's password

    RefreshTokenRequest:
      type: object
      description: Request to refresh access token
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: Refresh token

    ForgotPasswordRequest:
      type: object
      description: Request to initiate password reset
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: User's email address

    ForgotPasswordResponse:
      type: object
      description: Response for forgot password request
      required:
        - message
      properties:
        message:
          type: string
          description: Generic success message (never reveals if email exists)
          example: "If that email address is in our system, we've sent a password reset link to it."

    ResetPasswordRequest:
      type: object
      description: Request to reset password with token
      required:
        - token
        - newPassword
      properties:
        token:
          type: string
          description: Password reset token from email
        newPassword:
          type: string
          format: password
          minLength: 8
          description: New password (min 8 chars, must contain uppercase, lowercase, number, and special character)

    ResetPasswordResponse:
      type: object
      description: Response for successful password reset
      required:
        - message
      properties:
        message:
          type: string
          description: Success message
          example: "Password successfully reset. You can now sign in with your new password."

    SignupInitiateRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: User's email address

    SignupInitiateResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          example: "Verification email sent"

    SignupResendRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email

    SignupResendResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          example: "Verification email sent"

    SignupCompleteRequest:
      type: object
      required:
        - token
        - password
        - firstName
        - lastName
      properties:
        token:
          type: string
          description: Verification token from email (64 hex chars)
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 50
        firstName:
          type: string
          minLength: 2
        lastName:
          type: string
          minLength: 2

    CreateOrganizationRequest:
      type: object
      description: Request to create a new organization
      required:
        - name
        - subdomain
      properties:
        name:
          type: string
          description: Organization name
        subdomain:
          type: string
          description: Organization subdomain (unique identifier used in URLs)
        description:
          type: string
          description: Organization description
        logoUrl:
          type: string
          format: uri
          description: URL to the organization logo image

    UpdateOrganizationRequest:
      type: object
      description: Request to update an organization
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Organization name
        logoUrl:
          type: string
          format: uri
          description: URL to the organization logo image



    CreateInvitationRequest:
      type: object
      description: Request to create an invitation
      required:
        - email
        - role
      properties:
        email:
          type: string
          format: email
          description: Email of the invited user
        role:
          type: string
          description: Role Id

    UpdateInvitationRequest:
      type: object
      description: Request to update an invitation
      required:
        - role
      properties:
        role:
          type: string
          description: New role id

    AddOrganizationMemberRequest:
      type: object
      description: Request to add a member to an organization
      required:
        - userId
        - roleId
      properties:
        userId:
          type: string
          description: User ID
        roleId:
          type: string
          description: Role ID

    UpdateMemberRoleRequest:
      type: object
      description: Request to update a member's role
      required:
        - roleId
      properties:
        roleId:
          type: string
          description: New role ID

    CreateProjectRequest:
      type: object
      description: Request to create a new project
      required:
        - projectKey
        - name
        - projectType
      properties:
        projectKey:
          type: string
          description: Unique project key identifier (e.g., com.example.app)
        name:
          type: string
          description: Project name
        description:
          type: string
          description: Project description
        projectType:
          $ref: '#/components/schemas/ProjectType'

    UpdateProjectRequest:
      type: object
      description: Request to update a project
      required:
        - name
      properties:
        name:
          type: string
          description: Project name
        description:
          type: string
          description: Project description

    # Response DTOs
    UserResponse:
      type: object
      description: User information
      required:
        - id
        - email
        - firstName
        - lastName
        - status
        - organizations
        - createdAt
      properties:
        id:
          type: string
          description: User ID
        email:
          type: string
          format: email
          description: User's email address
        firstName:
          type: string
          description: User's first name
        lastName:
          type: string
          description: User's last name
        status:
          $ref: '#/components/schemas/UserStatusResponse'
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/UserOrganizationMembership'
          description: List of organizations the user is a member of
        createdAt:
          type: string
          format: date-time
          description: When the user was created
        updatedAt:
          type: string
          format: date-time
          description: When the user was last updated

    CurrentUserResponse:
      type: object
      description: Current user information with role and permissions for the current organization (determined by subdomain)
      required:
        - id
        - email
        - firstName
        - lastName
        - status
        - organizations
        - createdAt
      properties:
        id:
          type: string
          description: User ID
        email:
          type: string
          format: email
          description: User's email address
        firstName:
          type: string
          description: User's first name
        lastName:
          type: string
          description: User's last name
        status:
          $ref: '#/components/schemas/UserStatusResponse'
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/UserOrganizationMembership'
          description: List of organizations the user is a member of
        currentOrganizationRole:
          $ref: '#/components/schemas/RoleWithPermissionsResponse'
          description: The user's role with permissions in the current organization (determined by subdomain). Null if not accessing via organization subdomain.
          nullable: true
        createdAt:
          type: string
          format: date-time
          description: When the user was created
        updatedAt:
          type: string
          format: date-time
          description: When the user was last updated

    UpdateUserRequest:
      type: object
      description: Request to update user profile
      properties:
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          description: User's first name
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          description: User's last name
    
    UserOrganizationMembership:
      type: object
      description: User's membership in an organization
      required:
        - organization
        - role
      properties:
        organization:
          $ref: '#/components/schemas/UserOrganizationResponse'
        role:
          $ref: '#/components/schemas/RoleResponse'
        invitationStatus:
          $ref: '#/components/schemas/InvitationStatusResponse'
          nullable: true
          description: Invitation status (null for organization owners who were not invited)

    UserOrganizationResponse:
      type: object
      description: Minimal organization information for user response
      required:
        - id
        - name
        - subdomain
      properties:
        id:
          type: string
          description: Organization ID
        name:
          type: string
          description: Organization name
        subdomain:
          type: string
          description: Organization subdomain

    UserStatusResponse:
      type: object
      description: User status information
      required:
        - id
        - status
      properties:
        id:
          type: string
          description: Status ID
        status:
          $ref: '#/components/schemas/UserStatusEnum'

    AuthResponse:
      type: object
      description: Authentication response
      required:
        - accessToken
        - refreshToken
        - user
      properties:
        accessToken:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: Refresh token
        user:
          $ref: '#/components/schemas/UserResponse'

    OrganizationResponse:
      type: object
      description: Organization information
      required:
        - id
        - name
        - subdomain
        - createdAt
      properties:
        id:
          type: string
          description: Organization ID
        name:
          type: string
          description: Organization name
        subdomain:
          type: string
          description: Organization subdomain (unique identifier used in URLs)
        description:
          type: string
          description: Organization description
        logoUrl:
          type: string
          description: URL to the organization logo image
        createdAt:
          type: string
          format: date-time
          description: When the organization was created
        updatedAt:
          type: string
          format: date-time
          description: When the organization was last updated

    RoleResponse:
      type: object
      description: Role information (roles are now global across all organizations)
      required:
        - id
        - name
        - createdAt
      properties:
        id:
          type: string
          description: Role ID
        name:
          type: string
          description: Role name
        description:
          type: string
          description: Role description
        createdAt:
          type: string
          format: date-time
          description: When the role was created
        updatedAt:
          type: string
          format: date-time
          description: When the role was last updated

    PermissionCode:
      type: string
      description: Permission code enum representing all available permissions in the system
      enum:
        - organization.update
        - organization.view
        - member.view
        - member.invite
        - member.remove
        - member.update_role
        - project.read
        - project.create
        - project.update
        - project.delete
        - environment.view
        - environment.create
        - environment.update
        - environment.delete
        - changelog.view
        - changelog.create
        - changelog.update
        - changelog.delete
        - event.view
        - event.create
        - event.update
        - event.delete
        - analytics.view
        - support.operations
        - webhook.view
        - webhook.create
        - webhook.update
        - webhook.delete

    RoleWithPermissionsResponse:
      type: object
      description: Role information with associated permissions
      required:
        - id
        - name
        - permissions
      properties:
        id:
          type: string
          description: Role ID
        name:
          type: string
          description: Role name
        description:
          type: string
          description: Role description
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/PermissionCode'
          description: List of permission codes associated with this role

    InvitationResponse:
      type: object
      description: Invitation information
      required:
        - id
        - email
        - organization
        - role
        - status
        - createdAt
      properties:
        id:
          type: string
          description: Invitation ID
        email:
          type: string
          format: email
          description: Email of the invited user
        organization:
          $ref: '#/components/schemas/OrganizationResponse'
        role:
          $ref: '#/components/schemas/RoleResponse'
        status:
          $ref: '#/components/schemas/InvitationStatusResponse'
        invitedBy:
          $ref: '#/components/schemas/UserResponse'
        createdAt:
          type: string
          format: date-time
          description: When the invitation was created

    InvitationStatusResponse:
      type: object
      description: Invitation status information
      required:
        - id
        - status
      properties:
        id:
          type: string
          description: Status ID
        status:
          $ref: '#/components/schemas/InvitationStatusEnum'

    PendingInvitationSummary:
      type: object
      description: Minimal pending invitation information for member list
      required:
        - id
        - email
        - role
        - createdAt
      properties:
        id:
          type: string
          description: Invitation ID
        email:
          type: string
          format: email
          description: Email of the invited user
        role:
          $ref: '#/components/schemas/RoleResponse'
        invitedBy:
          $ref: '#/components/schemas/UserResponse'
          nullable: true
        createdAt:
          type: string
          format: date-time
          description: When the invitation was created

    MemberOrInvitationType:
      type: string
      enum: [MEMBER, INVITATION]
      description: Type discriminator for merged member/invitation list

    MemberOrInvitationItem:
      type: object
      description: Unified item representing either a member or pending invitation
      required:
        - id
        - type
        - email
        - role
        - timestamp
      properties:
        id:
          type: string
          description: Member ID or Invitation ID
        type:
          $ref: '#/components/schemas/MemberOrInvitationType'
        email:
          type: string
          format: email
          description: Email of the user (from user record for members, invitation email for invitations)
        role:
          $ref: '#/components/schemas/RoleResponse'
        timestamp:
          type: string
          format: date-time
          description: Enabled at timestamp for members, created at for invitations
        user:
          $ref: '#/components/schemas/UserResponse'
          nullable: true
          description: Full user details (only for members, null for invitations)

    PaginatedMemberOrInvitationResponse:
      type: object
      description: Paginated merged list of members and pending invitations
      required:
        - data
        - total
        - count
        - itemsPerPage
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/MemberOrInvitationItem'
          description: Array of members and invitations merged and sorted by timestamp
        total:
          type: integer
          description: Total number of items (members + invitations) across all pages
        count:
          type: integer
          description: Number of items in this page
        itemsPerPage:
          type: integer
          description: Maximum items per page

    MembersData:
      type: object
      description: Paginated members data
      required:
        - data
        - total
        - count
        - itemsPerPage
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationMemberResponse'
          description: Array of members for this page
        total:
          type: integer
          description: Total number of members across all pages
        count:
          type: integer
          description: Number of members in this page
        itemsPerPage:
          type: integer
          description: Maximum items per page

    InvitationsData:
      type: object
      description: Paginated pending invitations data
      required:
        - data
        - total
        - count
        - itemsPerPage
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PendingInvitationSummary'
          description: Array of pending invitations for this page
        total:
          type: integer
          description: Total number of pending invitations across all pages
        count:
          type: integer
          description: Number of invitations in this page
        itemsPerPage:
          type: integer
          description: Maximum items per page

    MembersAndInvitationsResponse:
      type: object
      description: Combined response with members and pending invitations
      required:
        - members
        - invitations
      properties:
        members:
          $ref: '#/components/schemas/MembersData'
        invitations:
          $ref: '#/components/schemas/InvitationsData'

    OrganizationMemberResponse:
      type: object
      description: Organization member information
      required:
        - id
        - user
        - role
        - enabledAt
      properties:
        id:
          type: string
          description: Member ID
        user:
          $ref: '#/components/schemas/UserResponse'
        role:
          $ref: '#/components/schemas/RoleResponse'
        enabledAt:
          type: string
          format: date-time
          description: When the member enabled their account

    PaginatedOrganizationMemberResponse:
      type: object
      description: Paginated organization member response
      required:
        - data
        - total
        - count
        - itemsPerPage
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationMemberResponse'
          description: Array of members for this page
        total:
          type: integer
          description: Total number of items across all pages
        count:
          type: integer
          description: Number of items in this page
        itemsPerPage:
          type: integer
          description: Maximum items per page

    ProjectResponse:
      type: object
      description: Project information
      required:
        - id
        - projectKey
        - organizationId
        - name
        - projectType
        - createdBy
        - createdAt
      properties:
        id:
          type: string
          description: Project ID
        projectKey:
          type: string
          description: Unique project key identifier
        organizationId:
          type: string
          description: Organization ID that owns this project
        name:
          type: string
          description: Project name
        description:
          type: string
          description: Project description
        projectType:
          $ref: '#/components/schemas/ProjectType'
        createdBy:
          type: string
          description: User ID who created the project
        createdAt:
          type: string
          format: date-time
          description: When the project was created
        updatedAt:
          type: string
          format: date-time
          description: When the project was last updated
        eventsEnabled:
          type: boolean
          description: Whether event logging is enabled for this project

    EventsStatusResponse:
      type: object
      description: Events status for a project
      required:
        - projectKey
        - eventsEnabled
      properties:
        projectKey:
          type: string
          description: Project key identifier
        eventsEnabled:
          type: boolean
          description: Whether event logging is enabled for this project

    ProjectSettingsResponse:
      type: object
      description: Project settings including event and IP logging configuration
      required:
        - projectKey
        - eventsEnabled
        - ipLoggingEnabled
      properties:
        projectKey:
          type: string
          description: Project key identifier
        eventsEnabled:
          type: boolean
          description: Whether event logging is enabled for this project
        ipLoggingEnabled:
          type: boolean
          description: Whether IP address logging is enabled for custom events

    UpdateProjectSettingsRequest:
      type: object
      description: Request to update project settings. All fields are optional - only provided fields will be updated.
      properties:
        eventsEnabled:
          type: boolean
          description: Whether event logging should be enabled for this project
        ipLoggingEnabled:
          type: boolean
          description: Whether IP address logging should be enabled for custom events

    UpdateEventsStatusRequest:
      type: object
      description: Request to update events status for a project
      required:
        - enabled
      properties:
        enabled:
          type: boolean
          description: Whether event logging should be enabled for this project

    BuildResponse:
      type: object
      description: Build information
      required:
        - id
        - organizationId
        - projectKey
        - commitHash
        - branchName
        - buildSize
        - buildUrl
        - nativeVersion
        - uploadedBy
        - createdAt
      properties:
        id:
          type: string
          description: Unique UUID identifier for the build
        organizationId:
          type: string
          description: Organization ID
        projectKey:
          type: string
          description: Project key identifier
        commitHash:
          type: string
          description: Git commit hash (unique identifier)
        branchName:
          type: string
          description: Git branch name
        commitMessage:
          type: string
          description: Git commit message
        buildSize:
          type: integer
          format: int64
          description: Build file size in bytes
        buildUrl:
          type: string
          description: URL to download the build file
        nativeVersion:
          type: string
          description: Native app version (e.g., "1.0.0")
        uploadedBy:
          type: string
          description: User ID who uploaded the build
        createdAt:
          type: string
          format: date-time
          description: When the build was uploaded
        updatedAt:
          type: string
          format: date-time
          description: When the build was last updated

    PaginatedBuildResponse:
      type: object
      description: Paginated build response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/BuildResponse'
          description: Array of builds for this page
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Items per page
        totalElements:
          type: integer
          description: Total number of builds
        totalPages:
          type: integer
          description: Total number of pages

    PaginatedApiKeyResponse:
      type: object
      description: Paginated API key response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ApiKeyResponse'
          description: Array of API keys for this page
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Items per page
        totalElements:
          type: integer
          description: Total number of API keys
        totalPages:
          type: integer
          description: Total number of pages

    CreateApiKeyRequest:
      type: object
      description: Request to create an API key
      required:
        - name
        - environmentName
      properties:
        name:
          type: string
          description: Name/description for the API key
        environmentName:
          type: string
          description: The environment this API key is scoped to

    CreateEnvironmentRequest:
      type: object
      description: Request to create a new environment
      required:
        - name
      properties:
        name:
          type: string
          description: Environment name
        description:
          type: string
          description: Environment description

    UpdateEnvironmentRequest:
      type: object
      description: Request to update an environment
      properties:
        name:
          type: string
          description: Environment name
        description:
          type: string
          description: Environment description

    CreateChangelogRequest:
      type: object
      description: Request to create a new changelog
      required:
        - version
        - markdown
      properties:
        version:
          type: string
          minLength: 1
          maxLength: 100
          description: Version string for this changelog (e.g., "1.0.0", "2.3.1")
        markdown:
          type: string
          description: Changelog content in Markdown format
        isPublished:
          type: boolean
          default: false
          description: Whether the changelog is published

    UpdateChangelogRequest:
      type: object
      description: Request to update a changelog
      properties:
        version:
          type: string
          minLength: 1
          maxLength: 100
          description: Version string for this changelog
        markdown:
          type: string
          description: Changelog content in Markdown format
        isPublished:
          type: boolean
          description: Whether the changelog is published

    ApiKeyResponse:
      type: object
      description: API key information
      required:
        - id
        - name
        - keyPrefix
        - projectKey
        - environmentId
        - environmentName
        - organizationId
        - createdBy
        - createdAt
      properties:
        id:
          type: string
          description: Unique identifier for the API key
        name:
          type: string
          description: Name/description of the API key
        key:
          type: string
          description: The actual API key (only returned on creation)
        keyPrefix:
          type: string
          description: Masked key display (e.g., "flyw...xyz")
        projectKey:
          type: string
          description: Project key this API key is for
        environmentId:
          type: string
          description: The environment ID this API key is scoped to
        environmentName:
          type: string
          description: The environment name this API key is scoped to
        organizationId:
          type: string
          description: Organization ID
        createdBy:
          type: string
          description: User ID who created the key
        lastUsedAt:
          type: string
          format: date-time
          description: When the key was last used
        createdAt:
          type: string
          format: date-time
          description: When the key was created
        updatedAt:
          type: string
          format: date-time
          description: When the key was last updated

    PermissionResponse:
      type: object
      description: Permission information
      required:
        - code
        - label
        - description
        - category
      properties:
        code:
          type: string
          description: Permission code (e.g., "organization.update")
        label:
          type: string
          description: Human-readable permission label
        description:
          type: string
          description: Permission description
        category:
          type: string
          description: Permission category (e.g., "organization", "member", "role")

    EnvironmentResponse:
      type: object
      description: Environment information
      required:
        - id
        - name
        - projectId
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Unique identifier for the environment
        name:
          type: string
          description: Environment name (unique within project)
        description:
          type: string
          description: Environment description
        projectId:
          type: string
          description: Project ID
        createdAt:
          type: string
          format: date-time
          description: When the environment was created
        updatedAt:
          type: string
          format: date-time
          description: When the environment was last updated

    PaginatedEnvironmentResponse:
      type: object
      description: Paginated environment response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/EnvironmentResponse'
          description: List of environments
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          description: Total number of environments
        totalPages:
          type: integer
          description: Total number of pages

    # OTA Update Schemas
    CreateOtaUpdateRequest:
      type: object
      description: Request to create a new OTA update
      required:
        - name
        - version
        - buildId
        - environmentId
        - minNativeVersion
        - updateMode
        - targetPlatform
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Name of the OTA update
        version:
          type: string
          minLength: 1
          maxLength: 50
          description: Version string for this OTA update (e.g., "1.0.0")
        buildId:
          type: string
          description: ID of the build associated with this OTA update
        environmentId:
          type: string
          description: ID of the environment this OTA update targets
        minNativeVersion:
          type: string
          minLength: 1
          maxLength: 50
          description: Minimum native app version required (e.g., "1.0.0")
        updateMode:
          $ref: '#/components/schemas/OtaUpdateModeEnum'
        targetPlatform:
          $ref: '#/components/schemas/OtaTargetPlatformEnum'
        targetingConditions:
          $ref: '#/components/schemas/TargetingConditions'

    UpdateOtaUpdateRequest:
      type: object
      description: Request to update an existing OTA update
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Name of the OTA update
        version:
          type: string
          minLength: 1
          maxLength: 50
          description: Version string for this OTA update
        buildId:
          type: string
          description: ID of the build associated with this OTA update
        environmentId:
          type: string
          description: ID of the environment this OTA update targets
        minNativeVersion:
          type: string
          minLength: 1
          maxLength: 50
          description: Minimum native app version required
        updateMode:
          $ref: '#/components/schemas/OtaUpdateModeEnum'
        targetPlatform:
          $ref: '#/components/schemas/OtaTargetPlatformEnum'
        targetingConditions:
          $ref: '#/components/schemas/TargetingConditions'

    OtaUpdateResponse:
      type: object
      description: OTA update information
      required:
        - id
        - name
        - version
        - buildId
        - environmentId
        - minNativeVersion
        - updateMode
        - targetPlatform
        - projectId
        - createdBy
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Unique identifier for the OTA update
        name:
          type: string
          description: Name of the OTA update
        version:
          type: string
          description: Version string for this OTA update
        buildId:
          type: string
          description: ID of the build associated with this OTA update
        environmentId:
          type: string
          description: ID of the environment this OTA update targets
        minNativeVersion:
          type: string
          description: Minimum native app version required
        updateMode:
          $ref: '#/components/schemas/OtaUpdateModeEnum'
        targetPlatform:
          $ref: '#/components/schemas/OtaTargetPlatformEnum'
        targetingConditions:
          $ref: '#/components/schemas/TargetingConditions'
        projectId:
          type: string
          description: Project ID
        createdBy:
          type: string
          description: User ID who created this OTA update
        createdAt:
          type: string
          format: date-time
          description: When the OTA update was created
        updatedAt:
          type: string
          format: date-time
          description: When the OTA update was last updated

    PaginatedOtaUpdateResponse:
      type: object
      description: Paginated OTA update response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OtaUpdateResponse'
          description: List of OTA updates
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          description: Total number of OTA updates
        totalPages:
          type: integer
          description: Total number of pages

    CheckOtaUpdateRequest:
      type: object
      description: Request to check for available OTA updates
      required:
        - platform
        - nativeVersion
      properties:
        platform:
          type: string
          enum: [ios, android]
          description: Client platform
        nativeVersion:
          type: string
          description: Current native app version (e.g., "1.0.0")
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Client metadata for targeting (e.g., user_id, device_id)

    ChangelogResponse:
      type: object
      description: Changelog information
      required:
        - id
        - version
        - markdown
        - isPublished
        - projectId
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Changelog ID
        version:
          type: string
          description: Version string for this changelog
        markdown:
          type: string
          description: Changelog content in Markdown format
        isPublished:
          type: boolean
          description: Whether the changelog is published
        projectId:
          type: string
          description: Project ID
        createdAt:
          type: string
          format: date-time
          description: When the changelog was created
        updatedAt:
          type: string
          format: date-time
          description: When the changelog was last updated

    PaginatedChangelogResponse:
      type: object
      description: Paginated changelog response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ChangelogResponse'
          description: List of changelogs
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          description: Total number of changelogs
        totalPages:
          type: integer
          description: Total number of pages

    AuditLogResponse:
      type: object
      description: Audit log entry
      required:
        - id
        - action
        - createdAt
      properties:
        id:
          type: string
          description: Unique identifier for the audit log entry
        userId:
          type: string
          description: ID of the user who performed the action
        organizationId:
          type: string
          description: ID of the organization
        action:
          type: string
          description: Action performed (e.g., PROJECT_CREATED, BUILD_UPLOADED)
        resourceType:
          type: string
          description: Type of resource affected (e.g., PROJECT, BUILD)
        resourceId:
          type: string
          description: ID of the affected resource
        resourceName:
          type: string
          description: Name of the affected resource
        httpMethod:
          type: string
          description: HTTP method used (GET, POST, PUT, DELETE)
        endpoint:
          type: string
          description: API endpoint called
        ipAddress:
          type: string
          description: IP address of the user
        userAgent:
          type: string
          description: User agent string
        requestBody:
          type: string
          description: Request body (if applicable)
        responseStatus:
          type: integer
          description: HTTP response status code
        errorMessage:
          type: string
          description: Error message (if action failed)
        metadata:
          type: string
          description: Additional metadata in JSON format
        createdAt:
          type: string
          format: date-time
          description: When the action occurred

    PaginatedAuditLogResponse:
      type: object
      description: Paginated audit log response
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AuditLogResponse'
          description: List of audit log entries
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          description: Total number of audit log entries
        totalPages:
          type: integer
          description: Total number of pages

    NotificationResponse:
      type: object
      description: Notification information
      required:
        - id
        - type
        - title
        - isRead
        - createdAt
      properties:
        id:
          type: string
          description: Notification ID
        type:
          $ref: '#/components/schemas/NotificationTypeEnum'
        title:
          type: string
          description: Notification title
        message:
          type: string
          description: Notification message body
        isRead:
          type: boolean
          description: Whether the notification has been read
        resourceId:
          type: string
          description: ID of the related resource (invitation_id, build_id, etc.)
        createdAt:
          type: string
          format: date-time
          description: When the notification was created

    PaginatedNotificationResponse:
      type: object
      description: Paginated notification response with unread count
      required:
        - data
        - unreadCount
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/NotificationResponse'
          description: Array of notifications for this page
        unreadCount:
          type: integer
          description: Total number of unread notifications
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          description: Total number of notifications
        totalPages:
          type: integer
          description: Total number of pages

    ErrorResponse:
      type: object
      description: Standardized error response
      required:
        - error
        - timestamp
      properties:
        error:
          type: object
          description: Error information
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: Machine-readable error code (e.g., AUTH_001, ORG_002)
              example: "AUTH_001"
            message:
              type: string
              description: Human-readable error message
              example: "Invalid credentials"
            details:
              type: object
              description: Additional structured error details
              additionalProperties: true
              example:
                field: "email"
                value: "user@example.com"
            stackTrace:
              type: string
              description: Stack trace of the exception (only included in development mode)
              example: "java.lang.RuntimeException: Test error\n\tat com.app.server.service.UserService.method(UserService.java:123)"
        timestamp:
          type: string
          format: date-time
          description: When the error occurred

    # ===========================
    # Custom Events (LogSnag-style)
    # ===========================
    
    LogEventRequest:
      type: object
      description: Request to log a custom event from SDK
      required:
        - event
      properties:
        event:
          type: string
          description: Event name
          example: "New Subscription"
        channel:
          type: string
          description: Optional channel/category for grouping events
          example: "payments"
        user_id:
          type: string
          description: External user identifier from client system
          example: "user-123"
        icon:
          type: string
          description: Emoji icon for the event
          example: ""
        notify:
          type: boolean
          description: Whether to trigger notifications
          default: false
        description:
          type: string
          description: Optional event description
          example: "User subscribed to premium plan"
        tags:
          type: object
          description: Key-value metadata for the event
          additionalProperties: true
          example:
            plan: "premium"
            cycle: "monthly"
            trial: false
        timestamp:
          type: string
          format: date-time
          description: When the event occurred (defaults to server time if not provided)
    
    LogEventResponse:
      type: object
      description: Response after logging an event
      required:
        - id
        - event
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Unique event identifier
        event:
          type: string
          description: Event name
        timestamp:
          type: string
          format: date-time
          description: When the event was recorded
    
    CustomEventResponse:
      type: object
      description: Full custom event details
      required:
        - id
        - event
        - timestamp
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique event identifier
        event:
          type: string
          description: Event name
        environmentName:
          type: string
          description: Name of the environment this event belongs to
        channel:
          type: string
          description: Channel/category
        userId:
          type: string
          description: External user identifier
        icon:
          type: string
          description: Emoji icon
        notify:
          type: boolean
          description: Whether notifications were triggered
        tags:
          type: object
          description: Key-value metadata
          additionalProperties: true
        description:
          type: string
          description: Event description
        timestamp:
          type: string
          format: date-time
          description: When the event occurred
        createdAt:
          type: string
          format: date-time
          description: When the event was recorded on server
        ipAddress:
          type: string
          description: IP address of the client that sent the event (if IP logging is enabled)
    
    PaginatedCustomEventResponse:
      type: object
      description: Paginated list of custom events
      required:
        - data
        - page
        - size
        - totalElements
        - totalPages
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/CustomEventResponse'
          description: Array of events for this page
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Items per page
        totalElements:
          type: integer
          description: Total number of items
        totalPages:
          type: integer
          description: Total number of pages
    
    EventStatsGroup:
      type: object
      description: A single group in event statistics
      required:
        - key
        - count
        - percentage
      properties:
        key:
          type: string
          description: Group key (event name, environment, channel, etc.)
        count:
          type: integer
          description: Number of events in this group
        percentage:
          type: number
          format: double
          description: Percentage of total events
    
    EventStatsResponse:
      type: object
      description: Aggregated event statistics
      required:
        - totalEvents
        - uniqueUsers
        - groups
      properties:
        from:
          type: string
          format: date-time
          description: Start of the time range
        to:
          type: string
          format: date-time
          description: End of the time range
        totalEvents:
          type: integer
          description: Total number of events in range
        uniqueUsers:
          type: integer
          description: Number of unique users
        groups:
          type: array
          items:
            $ref: '#/components/schemas/EventStatsGroup'
          description: Grouped event counts
    
    EventTimelinePoint:
      type: object
      description: A single data point in the timeline
      required:
        - timestamp
        - count
      properties:
        timestamp:
          type: string
          format: date-time
          description: Time bucket start
        count:
          type: integer
          description: Number of events in this bucket
    
    EventTimelineResponse:
      type: object
      description: Event counts over time for charts
      required:
        - interval
        - data
      properties:
        interval:
          type: string
          description: Time interval (hour, day, week, month)
          enum: [hour, day, week, month]
        data:
          type: array
          items:
            $ref: '#/components/schemas/EventTimelinePoint'
          description: Timeline data points

  responses:
    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    BadRequestError:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    UnauthorizedError:
      description: Unauthorized access
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    ForbiddenError:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    ConflictError:
      description: Conflict - resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    SubdomainHeader:
      name: X-Subdomain
      in: header
      required: false
      schema:
        type: string
      description: Organization subdomain (required for local development when not using subdomain-based URLs)

paths:
  /users:
    post:
      operationId: createUserAccount
      summary: Create user account
      description: Register a new user.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistrationRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /users/me:
    get:
      operationId: getCurrentUser
      summary: Get current user info with role and permissions for current organization
      description: |
        Returns the current user's information including their role and permissions 
        for the current organization (determined by the subdomain in the Origin header).
        If not accessing via an organization subdomain, currentOrganizationRole will be null.
      tags:
        - Users
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User information retrieved with role and permissions for current organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentUserResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    patch:
      operationId: updateCurrentUser
      summary: Update current user's profile
      description: Updates the current user's first name and/or last name.
      tags:
        - Users
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentUserResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/login:
    post:
      operationId: login
      summary: Sign in (context-aware based on subdomain)
      description: Sign in user. Context-aware based on subdomain for organization-scoped sessions.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/refresh-token:
    post:
      operationId: refreshToken
      summary: Refresh JWT token
      tags:
        - Authentication
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/forgot-password:
    post:
      operationId: forgotPassword
      summary: Request password reset
      description: |
        Request a password reset link. Always returns success message regardless of whether
        the email exists (security best practice to prevent email enumeration).
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        '200':
          description: Success response (always returned)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ForgotPasswordResponse'

  /auth/reset-password:
    post:
      operationId: resetPassword
      summary: Reset password with token
      description: Reset password using the token received via email
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: Password successfully reset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResetPasswordResponse'
        '400':
          description: Invalid request (invalid/expired/used token or weak password)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidToken:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "AUTH_007"
                      message: "Invalid or expired password reset token"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                usedToken:
                  summary: Token already used
                  value:
                    error:
                      code: "AUTH_008"
                      message: "Password reset token has already been used"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                weakPassword:
                  summary: Password doesn't meet requirements
                  value:
                    error:
                      code: "AUTH_009"
                      message: "Password must be at least 8 characters and contain uppercase, lowercase, digit, and special character"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"

  /auth/signup/initiate:
    post:
      operationId: initiateSignup
      summary: Initiate signup (send verification email)
      description: |
        Initiates the signup process by sending a verification email to the user.
        If a valid (unexpired) token already exists for this email, returns success without sending a new email (idempotent).
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupInitiateRequest'
      responses:
        '201':
          description: New verification email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignupInitiateResponse'
              example:
                message: "Verification email sent"
        '200':
          description: Valid token already exists (idempotent response)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignupInitiateResponse'
              example:
                message: "Email was already sent, check inbox"
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "AUTH_002"
                  message: "Email already registered"
                  details:
                    email: "user@example.com"
                timestamp: "2025-01-15T10:30:00.123Z"

  /auth/signup/complete:
    post:
      operationId: completeSignup
      summary: Complete signup with verification token or invitation
      description: |
        Completes the signup process in two possible ways:

        **Regular Signup (invitation=false or omitted):**
        - Verifies the signup token sent via email
        - Creates user account with 'user' role
        - Automatically logs in the user and returns JWT tokens

        **Invitation-Based Signup (invitation=true):**
        - Verifies the invitation token sent via email
        - Creates user account with 'user' role
        - Automatically adds user to the organization with the role specified in the invitation
        - Automatically logs in the user and returns JWT tokens
        - Email is pre-verified via the invitation (no separate verification needed)
      tags:
        - Authentication
      parameters:
        - name: invitation
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: |
            Set to true for invitation-based signup. When true, the token in the request body
            is treated as an invitation token rather than a signup verification token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupCompleteRequest'
            examples:
              regularSignup:
                summary: Regular signup (email verification token)
                value:
                  token: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
                  password: "SecurePass123!"
                  firstName: "John"
                  lastName: "Doe"
              invitationSignup:
                summary: Invitation-based signup (invitation token)
                value:
                  token: "inv_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
                  password: "SecurePass123!"
                  firstName: "Jane"
                  lastName: "Smith"
      responses:
        '201':
          description: User account created successfully and auto-logged in
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid request (invalid/expired token or weak password)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidSignupToken:
                  summary: Invalid or expired signup token
                  value:
                    error:
                      code: "AUTH_010"
                      message: "Invalid or expired signup token"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                invalidInvitationToken:
                  summary: Invalid or expired invitation token
                  value:
                    error:
                      code: "INV_001"
                      message: "Invalid or expired invitation token"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                expiredInvitation:
                  summary: Invitation has expired
                  value:
                    error:
                      code: "INV_002"
                      message: "This invitation has expired"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                alreadyAccepted:
                  summary: Invitation already accepted
                  value:
                    error:
                      code: "INV_003"
                      message: "This invitation has already been accepted"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
                weakPassword:
                  summary: Password doesn't meet requirements
                  value:
                    error:
                      code: "AUTH_009"
                      message: "Password must be at least 8 characters and contain uppercase, lowercase, digit, and special character"
                      details: {}
                    timestamp: "2025-01-15T10:30:00.123Z"
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                emailExists:
                  summary: Email already registered
                  value:
                    error:
                      code: "AUTH_002"
                      message: "Email already registered"
                      details:
                        email: "user@example.com"
                    timestamp: "2025-01-15T10:30:00.123Z"
                emailExistsInvitation:
                  summary: Email already registered (invitation flow)
                  value:
                    error:
                      code: "AUTH_002"
                      message: "An account with this email already exists. Please log in to accept the invitation."
                      details:
                        email: "user@example.com"
                    timestamp: "2025-01-15T10:30:00.123Z"

  /organizations:
    get:
      operationId: listOrganizations
      summary: List user's organizations
      description: Returns all organizations that the authenticated user is a member of. Does not require subdomain context.
      tags:
        - Organizations
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Organizations retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrganizationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    
    post:
      operationId: createOrganization
      summary: Create a new organization
      description: Users can create up to 3 organizations. Does not require subdomain context.
      tags:
        - Organizations
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationRequest'
      responses:
        '201':
          description: Organization created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /organizations/current:
    get:
      operationId: getCurrentOrganization
      summary: Get current organization details
      description: Get organization details based on the subdomain context. User must be a member of the organization.
      tags:
        - Organizations
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
      responses:
        '200':
          description: Organization retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationResponse'
        '400':
          description: Subdomain is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    patch:
      operationId: updateOrganization
      summary: Update organization
      description: |
        Update organization fields. Supports partial updates (PATCH semantics) - only provided fields will be updated.

        Updatable fields:
        - name: Organization display name
        - logoUrl: URL to organization logo image

        Immutable fields (cannot be changed):
        - subdomain: Organization subdomain identifier
        - created_at, created_by_user_id: Creation metadata

        Note: At least one field must be provided in the request. Requires Owner/Admin role or organization.update permission.
      tags:
        - Organizations
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrganizationRequest'
      responses:
        '200':
          description: Organization updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /roles:
    get:
      operationId: listRoles
      summary: List available roles
      description: Returns all global roles that can be assigned to organization members
      tags:
        - Roles & Permissions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoleResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /invite:
    post:
      operationId: sendInvitation
      summary: Send invitation
      description: Send an invitation to add a new member to the organization. Organization context determined by subdomain. Requires Owner/Admin role.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInvitationRequest'
      responses:
        '201':
          description: Invitation sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /invitations:
    get:
      operationId: listPendingInvitations
      summary: List pending invitations
      description: |
        List all pending, non-expired invitations addressed to the authenticated user's email.
        Returns invitations from all organizations where the user has been invited.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Invitations retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InvitationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /invitations/{invitationId}/revoke:
    delete:
      operationId: revokeInvitation
      summary: Revoke invitation (deletes user too)
      description: Revoke an invitation. Also deletes the associated user if created. Organization context determined by subdomain. Requires Owner/Admin role.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
          description: Invitation ID
      responses:
        '204':
          description: Invitation revoked successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /invitations/{invitationId}/accept:
    post:
      operationId: acceptInvitation
      summary: Accept invitation and join organization
      description: |
        Accept an invitation and join the organization. Requires authentication.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
          description: Invitation ID
      responses:
        '200':
          description: Invitation accepted successfully, user is now a member
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          description: Bad request (invitation expired or already accepted)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                expired:
                  value:
                    code: INV_002
                    message: This invitation has expired
                already_accepted:
                  value:
                    code: INV_003
                    message: This invitation has already been accepted
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Forbidden (email mismatch)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: INV_006
                message: This invitation is addressed to different email
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          description: Conflict (user already member)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: INV_004
                message: You are already a member of this organization

  /invitations/accept/{token}:
    post:
      operationId: acceptInvitationByToken
      summary: Accept invitation by token
      description: Accept invitation using token from email link. Requires authentication.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Invitation token from email
      responses:
        '200':
          description: Invitation accepted, user joined organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          description: Invalid invitation state (expired/already accepted)
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Invalid token
        '409':
          description: User already member

  /invitations/reject/{token}:
    post:
      operationId: rejectInvitationByToken
      summary: Reject invitation by token
      description: Reject invitation using token from email link. Requires authentication. Updates status to canceled.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Invitation token from email
      responses:
        '200':
          description: Invitation rejected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          description: Invalid invitation state (not pending)
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Invalid token

  /invitations/{identifier}:
    get:
      operationId: getInvitation
      summary: Get invitation by ID or token
      description: |
        Retrieve an invitation by ID or token. Must belong to authenticated user.
        Use query parameter 'type' to specify lookup method:
        - type=id (default): lookup by invitation ID
        - type=token: lookup by invitation token
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: identifier
          in: path
          required: true
          description: Invitation ID or token
          schema:
            type: string
        - name: type
          in: query
          required: false
          description: Lookup method (id or token)
          schema:
            type: string
            enum: [id, token]
            default: id
      responses:
        '200':
          description: Invitation retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Invitation not addressed to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /invitations/{invitationId}:
    patch:
      operationId: updateInvitation
      summary: Update invitation role
      description: |
        Update the role of a pending invitation. Only pending invitations can be updated.
        Requires member.invite permission.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
          description: Invitation ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInvitationRequest'
      responses:
        '200':
          description: Invitation updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          description: Bad request (e.g., invitation not pending, invalid role)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notPending:
                  summary: Invitation not pending
                  value:
                    error:
                      code: INV_007
                      message: Cannot update invitation that is not in pending status
                ownerRole:
                  summary: Cannot assign owner role
                  value:
                    error:
                      code: VAL_001
                      message: Cannot assign 'owner' role via invitation
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /invitations/{invitationId}/cancel:
    get:
      operationId: cancelInvitation
      summary: Cancel/reject invitation (keeps user)
      description: |
        Cancel or reject an invitation. Requires authentication.
        Updates invitation status to 'canceled' but keeps the user account.
      tags:
        - Invitations
      security:
        - BearerAuth: []
      parameters:
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
          description: Invitation ID
      responses:
        '200':
          description: Invitation canceled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /members:
    get:
      operationId: listOrganizationMembers
      summary: List organization members
      description: List all members of the organization. Organization context determined by subdomain. Any member can view.
      tags:
        - Members
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: page
          in: query
          description: Page number (0-based)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Members and invitations retrieved successfully (merged and sorted by timestamp)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedMemberOrInvitationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /members/{membershipId}:
    patch:
      operationId: updateMemberRole
      summary: Update member role
      description: Update a member's role. Organization context determined by subdomain. Requires Owner/Admin role.
      tags:
        - Members/member
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: membershipId
          in: path
          required: true
          schema:
            type: string
          description: Membership ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMemberRoleRequest'
      responses:
        '200':
          description: Member role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationMemberResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    delete:
      operationId: removeMember
      summary: Remove member
      description: Remove a member from the organization. Organization context determined by subdomain. Requires Owner/Admin role. Owner cannot remove themselves.
      tags:
        - Members
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: membershipId
          in: path
          required: true
          schema:
            type: string
          description: Membership ID
      responses:
        '204':
          description: Member removed successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects:
    get:
      operationId: listProjects
      summary: List projects
      description: List all projects for the organization. Organization context determined by subdomain. Any member can view.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
      responses:
        '200':
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    
    post:
      operationId: createProject
      summary: Create project
      description: Create a new project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /projects/{projectKey}:
    get:
      operationId: getProject
      summary: Get project details
      description: Get project details. Organization context determined by subdomain. Any member can view.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      responses:
        '200':
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    patch:
      operationId: updateProject
      summary: Update project
      description: Update project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    delete:
      operationId: deleteProject
      summary: Delete project
      description: Delete project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      responses:
        '204':
          description: Project deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/events-status:
    get:
      operationId: getEventsStatus
      summary: Get events status
      description: Get whether event logging is enabled for a project. Organization context determined by subdomain.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      responses:
        '200':
          description: Events status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventsStatusResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    put:
      operationId: updateEventsStatus
      summary: Update events status
      description: Enable or disable event logging for a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEventsStatusRequest'
      responses:
        '200':
          description: Events status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventsStatusResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/settings:
    get:
      operationId: getProjectSettings
      summary: Get project settings
      description: Get project settings including event logging and IP logging configuration. Organization context determined by subdomain.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      responses:
        '200':
          description: Project settings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectSettingsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    patch:
      operationId: updateProjectSettings
      summary: Update project settings
      description: Update project settings. Only provided fields will be updated. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Projects
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectSettingsRequest'
      responses:
        '200':
          description: Project settings updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectSettingsResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/builds:
    get:
      operationId: getBuilds
      summary: Get builds with pagination and sorting
      description: Organization context determined by subdomain.
      tags:
        - Builds
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (default 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Page size (default 20)
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction by createdAt (default desc)
      responses:
        '200':
          description: Builds retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedBuildResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /builds/{buildId}:
    delete:
      operationId: deleteBuild
      summary: Delete a build by its UUID
      description: Organization context determined by subdomain.
      tags:
        - Builds
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: buildId
          in: path
          required: true
          schema:
            type: string
          description: The UUID of the build to delete
      responses:
        '204':
          description: Build deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /v1/builds:
    post:
      operationId: uploadBuildWithApiKey
      summary: Upload a new build using API key authentication
      description: "Upload builds using API key authentication. This is the only way to upload builds and is designed for CI/CD pipelines. Requires X-API-Key header instead of JWT token. Organization context is determined by the API key."
      tags:
        - Builds
        - API Keys
      parameters:
        - name: X-API-Key
          in: header
          required: true
          schema:
            type: string
          description: API key for authentication (e.g., "flyway_abc123...")
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - commitHash
                - branchName
                - nativeVersion
                - file
              properties:
                commitHash:
                  type: string
                  description: Git commit hash (unique identifier for the build)
                branchName:
                  type: string
                  description: Git branch name
                commitMessage:
                  type: string
                  description: Git commit message
                nativeVersion:
                  type: string
                  description: Native app version (e.g., "1.0.0")
                file:
                  type: string
                  format: binary
                  description: The build file (APK/IPA, max 30MB)
      responses:
        '201':
          description: Build uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BuildResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /v1/ota/check:
    post:
      operationId: checkOtaUpdate
      summary: Check for available OTA updates
      description: "Check if there's an applicable OTA update for the client. Uses API key authentication. Returns the latest matching OTA update based on platform, native version, and targeting conditions."
      tags:
        - OTA Updates
      parameters:
        - name: X-API-Key
          in: header
          required: true
          schema:
            type: string
          description: API key for authentication (e.g., "flyway_abc123...")
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckOtaUpdateRequest'
      responses:
        '200':
          description: OTA update found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtaUpdateResponse'
        '204':
          description: No applicable OTA update found
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /projects/{projectKey}/api-keys:
    get:
      operationId: getApiKeys
      summary: Get API keys with pagination and sorting
      description: Organization context determined by subdomain.
      tags:
        - API Keys
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (default 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Page size (default 20)
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction by createdAt (default desc)
      responses:
        '200':
          description: API keys retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedApiKeyResponse'
        '400':
          description: Bad request (e.g., invalid sort parameter)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    post:
      operationId: createApiKey
      summary: Create a new API key
      description: Organization context determined by subdomain.
      tags:
        - API Keys
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApiKeyRequest'
      responses:
        '201':
          description: API key created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/api-keys/{keyId}:
    delete:
      operationId: deleteApiKey
      summary: Delete an API key
      description: Organization context determined by subdomain.
      tags:
        - API Keys
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key identifier
        - name: keyId
          in: path
          required: true
          schema:
            type: string
          description: API key ID
      responses:
        '204':
          description: API key deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/environments:
    get:
      operationId: listEnvironments
      summary: List environments
      description: List all environments for a project. Organization context determined by subdomain. Any member can view.
      tags:
        - Environments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (0-based)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Number of items per page
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction by creation date
      responses:
        '200':
          description: Environments retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedEnvironmentResponse'
        '400':
          description: Bad request (e.g., invalid sort parameter)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    post:
      operationId: createEnvironment
      summary: Create environment
      description: Create a new environment in a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Environments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnvironmentRequest'
      responses:
        '201':
          description: Environment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /projects/{projectKey}/environments/{environmentId}:
    get:
      operationId: getEnvironment
      summary: Get environment details
      description: Get environment details by ID within a project. Organization context determined by subdomain. Any member can view.
      tags:
        - Environments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Environment ID (UUID)
      responses:
        '200':
          description: Environment retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    patch:
      operationId: updateEnvironment
      summary: Update environment
      description: Update environment by ID within a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Environments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Environment ID (UUID)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEnvironmentRequest'
      responses:
        '200':
          description: Environment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
    
    delete:
      operationId: deleteEnvironment  
      summary: Delete environment
      description: Delete environment by ID within a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - Environments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Environment ID (UUID)
      responses:
        '204':
          description: Environment deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ==================== OTA Updates ====================
  /projects/{projectKey}/ota-updates:
    get:
      operationId: listOtaUpdates
      summary: List OTA updates
      description: List all OTA updates for a project with optional environment filter. Organization context determined by subdomain.
      tags:
        - OTA Updates
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: environmentId
          in: query
          required: false
          schema:
            type: string
          description: Optional environment ID to filter OTA updates
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (0-based)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Number of items per page
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction by creation date
      responses:
        '200':
          description: OTA updates retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedOtaUpdateResponse'
        '400':
          description: Bad request (e.g., invalid sort parameter)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    post:
      operationId: createOtaUpdate
      summary: Create OTA update
      description: Create a new OTA update for a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - OTA Updates
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOtaUpdateRequest'
      responses:
        '201':
          description: OTA update created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtaUpdateResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /projects/{projectKey}/ota-updates/{otaUpdateId}:
    get:
      operationId: getOtaUpdate
      summary: Get OTA update details
      description: Get OTA update details by ID within a project. Organization context determined by subdomain.
      tags:
        - OTA Updates
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: otaUpdateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: OTA update ID (UUID)
      responses:
        '200':
          description: OTA update retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtaUpdateResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    patch:
      operationId: updateOtaUpdate
      summary: Update OTA update
      description: Update OTA update by ID within a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - OTA Updates
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: otaUpdateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: OTA update ID (UUID)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOtaUpdateRequest'
      responses:
        '200':
          description: OTA update updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtaUpdateResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
    
    delete:
      operationId: deleteOtaUpdate
      summary: Delete OTA update
      description: Delete OTA update by ID within a project. Organization context determined by subdomain. Requires Developer+ role.
      tags:
        - OTA Updates
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: otaUpdateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: OTA update ID (UUID)
      responses:
        '204':
          description: OTA update deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/changelogs:
    get:
      operationId: listChangelogs
      summary: List changelogs
      description: List all changelogs for a project. Organization context determined by subdomain.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (0-based)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Number of items per page
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction by creation date
      responses:
        '200':
          description: Changelogs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedChangelogResponse'
        '400':
          description: Bad request (e.g., invalid sort parameter)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    post:
      operationId: createChangelog
      summary: Create changelog
      description: Create a new changelog in a project. Organization context determined by subdomain.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChangelogRequest'
      responses:
        '201':
          description: Changelog created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangelogResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /projects/{projectKey}/changelogs/{changelogId}:
    get:
      operationId: getChangelog
      summary: Get changelog
      description: Get changelog details. Organization context determined by subdomain.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: changelogId
          in: path
          required: true
          schema:
            type: string
          description: Changelog ID
      responses:
        '200':
          description: Changelog retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangelogResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    
    put:
      operationId: updateChangelog
      summary: Update changelog
      description: Update changelog within a project. Organization context determined by subdomain.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: changelogId
          in: path
          required: true
          schema:
            type: string
          description: Changelog ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChangelogRequest'
      responses:
        '200':
          description: Changelog updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangelogResponse'
        '400':
          description: Bad request (e.g., validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
    
    delete:
      operationId: deleteChangelog
      summary: Delete changelog
      description: Delete changelog within a project. Organization context determined by subdomain.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: changelogId
          in: path
          required: true
          schema:
            type: string
          description: Changelog ID
      responses:
        '204':
          description: Changelog deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /audit-logs:
    get:
      operationId: getAuditLogs
      summary: Get audit logs for an organization
      description: Retrieve paginated audit logs with optional filtering by action, resource type, user, and date range. Organization context determined by subdomain.
      tags:
        - Audit Logs
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SubdomainHeader'
        - name: action
          in: query
          required: false
          schema:
            type: string
          description: Filter by action (e.g., PROJECT_CREATED)
        - name: resourceType
          in: query
          required: false
          schema:
            type: string
          description: Filter by resource type (e.g., PROJECT)
        - name: userId
          in: query
          required: false
          schema:
            type: string
          description: Filter by user ID
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Filter by start date
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Filter by end date
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (0-indexed)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Page size
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order by created date
      responses:
        '200':
          description: Audit logs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAuditLogResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /notifications:
    get:
      operationId: getNotifications
      summary: Get user notifications
      description: Get paginated list of notifications for the authenticated user with unread count.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Page number (0-indexed)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Page size
        - name: unreadOnly
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: If true, only return unread notifications
      responses:
        '200':
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedNotificationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /notifications/{notificationId}/read:
    patch:
      operationId: markNotificationAsRead
      summary: Mark notification as read
      description: Mark a single notification as read.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
          description: Notification ID
      responses:
        '200':
          description: Notification marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /notifications/read-all:
    patch:
      operationId: markAllNotificationsAsRead
      summary: Mark all notifications as read
      description: Mark all notifications for the authenticated user as read.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      responses:
        '204':
          description: All notifications marked as read
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # Webhook Management
  /webhooks:
    get:
      operationId: listWebhooks
      summary: List webhooks
      description: List all webhook subscriptions for the current organization. Requires webhook.view permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of webhooks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedWebhookResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

    post:
      operationId: createWebhook
      summary: Create webhook
      description: Create a new webhook subscription for the current organization. Requires webhook.create permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWebhookRequest'
      responses:
        '201':
          description: Webhook created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /webhooks/{webhookId}:
    get:
      operationId: getWebhook
      summary: Get webhook details
      description: Get details of a specific webhook subscription. Requires webhook.view permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
          description: Webhook ID
      responses:
        '200':
          description: Webhook details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      operationId: updateWebhook
      summary: Update webhook
      description: Update an existing webhook subscription. Requires webhook.update permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
          description: Webhook ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWebhookRequest'
      responses:
        '200':
          description: Webhook updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      operationId: deleteWebhook
      summary: Delete webhook
      description: Delete a webhook subscription. Requires webhook.delete permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
          description: Webhook ID
      responses:
        '204':
          description: Webhook deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /webhooks/{webhookId}/deliveries:
    get:
      operationId: listWebhookDeliveries
      summary: List webhook deliveries
      description: List delivery attempts for a specific webhook. Requires webhook.view permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
          description: Webhook ID
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 20
        - name: success
          in: query
          schema:
            type: boolean
          description: Filter by success status
      responses:
        '200':
          description: List of webhook deliveries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedWebhookDeliveryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /webhooks/{webhookId}/test:
    post:
      operationId: testWebhook
      summary: Test a webhook
      description: Sends a test "Hello World" payload to the webhook endpoint and returns the delivery result. Requires webhook.update permission.
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
          description: Webhook ID
      responses:
        '200':
          description: Test delivery result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookDeliveryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ===========================
  # Custom Events - SDK API
  # ===========================
  
  /v1/logs:
    post:
      operationId: logEvent
      summary: Log a custom event
      description: |
        Log a custom event from SDK. Authentication is via API key (Bearer token).
        The project is automatically determined from the API key.
      tags:
        - Events
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogEventRequest'
      responses:
        '201':
          description: Event logged successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogEventResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ===========================
  # Changelogs - SDK API
  # ===========================

  /v1/changelogs/{version}:
    get:
      operationId: getChangelogByVersion
      summary: Get changelog by version
      description: |
        Get a published changelog by version. Authentication is via API key (Bearer token).
        The project is automatically determined from the API key.
        Only returns published changelogs.
      tags:
        - Changelogs
      security:
        - BearerAuth: []
      parameters:
        - name: version
          in: path
          required: true
          schema:
            type: string
          description: Version string of the changelog (e.g., "1.0.0", "2.3.1")
      responses:
        '200':
          description: Changelog retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangelogResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ===========================
  # Custom Events - Dashboard API
  # ===========================
  
  /projects/{projectKey}/events:
    get:
      operationId: listEvents
      summary: List custom events
      description: List custom events for a project with pagination and filters. Requires event.view permission.
      tags:
        - Event Analytics
      security:
        - BearerAuth: []
      parameters:
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: environment_name
          in: query
          schema:
            type: string
          description: Filter by environment name (partial match)
        - name: event
          in: query
          schema:
            type: string
          description: Filter by event name
        - name: channel
          in: query
          schema:
            type: string
          description: Filter by channel
        - name: user_id
          in: query
          schema:
            type: string
          description: Filter by user ID
        - name: from
          in: query
          schema:
            type: string
            format: date-time
          description: Start of time range
        - name: to
          in: query
          schema:
            type: string
            format: date-time
          description: End of time range
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: Page number
        - name: size
          in: query
          schema:
            type: integer
            default: 50
          description: Page size
        - name: sort
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order by timestamp
      responses:
        '200':
          description: Paginated list of events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedCustomEventResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/events/{eventId}:
    get:
      operationId: getEvent
      summary: Get event details
      description: Get details of a specific custom event. Requires event.view permission.
      tags:
        - Event Analytics
      security:
        - BearerAuth: []
      parameters:
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: Event ID
      responses:
        '200':
          description: Event details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomEventResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/events/stats:
    get:
      operationId: getEventStats
      summary: Get aggregated event statistics
      description: Get aggregated event statistics with grouping. Requires event.view permission.
      tags:
        - Event Analytics
      security:
        - BearerAuth: []
      parameters:
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: group_by
          in: query
          schema:
            type: string
            enum: [event, environment, channel, user_id]
            default: event
          description: Field to group by
        - name: environment_name
          in: query
          schema:
            type: string
          description: Filter by environment name (partial match)
        - name: channel
          in: query
          schema:
            type: string
          description: Filter by channel
        - name: from
          in: query
          schema:
            type: string
            format: date-time
          description: Start of time range
        - name: to
          in: query
          schema:
            type: string
            format: date-time
          description: End of time range
      responses:
        '200':
          description: Aggregated event statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventStatsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/events/timeline:
    get:
      operationId: getEventTimeline
      summary: Get event timeline for charts
      description: Get event counts over time intervals for chart visualization. Requires event.view permission.
      tags:
        - Event Analytics
      security:
        - BearerAuth: []
      parameters:
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: interval
          in: query
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
          description: Time interval for grouping
        - name: event
          in: query
          schema:
            type: string
          description: Filter by event name
        - name: environment_name
          in: query
          schema:
            type: string
          description: Filter by environment name (partial match)
        - name: from
          in: query
          schema:
            type: string
            format: date-time
          description: Start of time range
        - name: to
          in: query
          schema:
            type: string
            format: date-time
          description: End of time range
      responses:
        '200':
          description: Event timeline data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventTimelineResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectKey}/events/users/{userId}:
    get:
      operationId: listEventsByUserId
      summary: List events by user ID
      description: List all custom events for a specific user ID within a project. Requires event.view permission.
      tags:
        - Event Analytics
      security:
        - BearerAuth: []
      parameters:
        - name: projectKey
          in: path
          required: true
          schema:
            type: string
          description: Project key
        - name: userId
          in: path
          required: true
          schema:
            type: string
          description: User ID to filter events by
        - name: event
          in: query
          schema:
            type: string
          description: Filter by event name (partial match)
        - name: from
          in: query
          schema:
            type: string
            format: date-time
          description: Start of time range
        - name: to
          in: query
          schema:
            type: string
            format: date-time
          description: End of time range
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: Page number
        - name: size
          in: query
          schema:
            type: integer
            default: 50
          description: Page size
        - name: sort
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order by timestamp
      responses:
        '200':
          description: Paginated list of events for the user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedCustomEventResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
